<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>관리자 로그인 - 티켓팅 시스템</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 400px; margin: 100px auto; padding: 20px; background: #f5f5f5; }
        .login-card { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); border-left: 5px solid #dc3545; }
        h2 { text-align: center; color: #dc3545; margin-bottom: 30px; }
        .admin-badge { background: #dc3545; color: white; padding: 5px 10px; border-radius: 4px; font-size: 12px; text-align: center; margin-bottom: 20px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #555; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        input:focus { border-color: #dc3545; outline: none; }
        .login-btn { width: 100%; background: #dc3545; color: white; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; margin-top: 10px; }
        .login-btn:hover { background: #c82333; }
        .login-btn:disabled { background: #6c757d; cursor: not-allowed; }
        .test-accounts { background: #ffebee; padding: 15px; border-radius: 6px; margin-bottom: 20px; font-size: 14px; border: 1px solid #ffcdd2; }
        .test-accounts h4 { margin: 0 0 10px 0; color: #c62828; }
        .result { margin-top: 20px; padding: 15px; border-radius: 6px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .loading { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .back-link { text-align: center; margin-top: 20px; }
        .back-link a { color: #dc3545; text-decoration: none; }
        .back-link a:hover { text-decoration: underline; }
        .warning { background: #fff3cd; color: #856404; padding: 10px; border-radius: 4px; margin-bottom: 15px; font-size: 13px; }
    </style>
</head>
<body>
<div class="login-card">
    <div class="admin-badge">관리자 전용</div>
    <h2>관리자 로그인</h2>

    <div class="warning">
        ⚠️ 관리자 권한이 있는 계정만 로그인할 수 있습니다.
    </div>

    <div class="test-accounts">
        <h4>테스트 관리자 계정</h4>
        <strong>관리자:</strong> admin@ticket.com / password123
    </div>

    <form id="adminLoginForm">
        <div class="form-group">
            <label for="usernameOrEmail">관리자 이메일 또는 사용자명</label>
            <input
                    id="usernameOrEmail"
                    name="usernameOrEmail"
                    value="admin@ticket.com"
                    placeholder="관리자 계정을 입력하세요"
                    required>
        </div>

        <div class="form-group">
            <label for="password">비밀번호</label>
            <input
                    id="password"
                    name="password"
                    type="password"
                    value="password123"
                    placeholder="비밀번호를 입력하세요"
                    required>
        </div>

        <button type="submit" class="login-btn" id="loginBtn">관리자 로그인</button>
    </form>

    <div id="result"></div>

    <div class="back-link">
        <a href="/">← 메인으로 돌아가기</a> |
        <a href="/login.html">일반 로그인</a>
    </div>
</div>

<script>
    const loginForm = document.getElementById('adminLoginForm');
    const resultDiv = document.getElementById('result');
    const loginBtn = document.getElementById('loginBtn');

    // 이미 관리자로 로그인된 경우 체크
    const existingToken = localStorage.getItem('accessToken');
    const existingUserType = localStorage.getItem('userType');
    if (existingToken && existingUserType === 'ADMIN') {
        resultDiv.innerHTML = '<div class="success">이미 관리자로 로그인되어 있습니다. 메인으로 이동합니다...</div>';
        setTimeout(() => { window.location.href = '/'; }, 2000);
    }

    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const usernameOrEmail = document.getElementById('usernameOrEmail').value;
        const password = document.getElementById('password').value;

        // 버튼 비활성화 및 로딩 표시
        loginBtn.disabled = true;
        loginBtn.textContent = '로그인 중...';
        resultDiv.innerHTML = '<div class="loading">관리자 인증을 처리하고 있습니다...</div>';

        try {
            const response = await fetch('/admin/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    usernameOrEmail: usernameOrEmail,
                    password: password
                })
            });

            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.message || `로그인 실패 (${response.status})`);
            }

            // 관리자 토큰 저장
            localStorage.setItem('accessToken', data.accessToken);
            localStorage.setItem('userType', data.userType);

            resultDiv.innerHTML = `
                    <div class="success">
                        <strong>관리자 로그인 성공!</strong><br>
                        권한: ${data.userType}<br>
                        관리자 대시보드로 이동합니다...
                    </div>
                `;

            // 2초 후 메인 페이지로 리다이렉트
            setTimeout(() => {
                window.location.href = '/';
            }, 2000);

        } catch (error) {
            resultDiv.innerHTML = `
                    <div class="error">
                        <strong>관리자 로그인 실패:</strong><br>
                        ${error.message}
                    </div>
                `;
        } finally {
            // 버튼 다시 활성화
            loginBtn.disabled = false;
            loginBtn.textContent = '관리자 로그인';
        }
    });

    // 엔터키로 로그인
    document.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            loginForm.dispatchEvent(new Event('submit'));
        }
    });
</script>
</body>
</html>