<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>로그인 - 티켓팅 시스템</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 400px; margin: 100px auto; padding: 20px; background: #f5f5f5; }
        .login-card { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        h2 { text-align: center; color: #333; margin-bottom: 30px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #555; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        input:focus { border-color: #007bff; outline: none; }
        .login-btn { width: 100%; background: #007bff; color: white; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; margin-top: 10px; }
        .login-btn:hover { background: #0056b3; }
        .login-btn:disabled { background: #6c757d; cursor: not-allowed; }
        .test-accounts { background: #e9ecef; padding: 15px; border-radius: 6px; margin-bottom: 20px; font-size: 14px; }
        .test-accounts h4 { margin: 0 0 10px 0; color: #495057; }
        .result { margin-top: 20px; padding: 15px; border-radius: 6px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .loading { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .back-link { text-align: center; margin-top: 20px; }
        .back-link a { color: #007bff; text-decoration: none; }
        .back-link a:hover { text-decoration: underline; }
    </style>
</head>
<body>
<div class="login-card">
    <h2>로그인</h2>

    <div class="test-accounts">
        <h4>테스트 계정</h4>
        <strong>관리자:</strong> admin@ticket.com / password123<br>
        <strong>일반사용자:</strong> user@ticket.com / password123<br>
        <strong>사용자명:</strong> testuser / password123
    </div>

    <form id="loginForm">
        <div class="form-group">
            <label for="usernameOrEmail">이메일 또는 사용자명</label>
            <input
                    id="usernameOrEmail"
                    name="usernameOrEmail"
                    value="admin@ticket.com"
                    placeholder="이메일 또는 사용자명을 입력하세요"
                    required>
        </div>

        <div class="form-group">
            <label for="password">비밀번호</label>
            <input
                    id="password"
                    name="password"
                    type="password"
                    value="password123"
                    placeholder="비밀번호를 입력하세요"
                    required>
        </div>

        <button type="submit" class="login-btn" id="loginBtn">로그인</button>
    </form>

    <div id="result"></div>

    <div class="back-link">
        <a href="/">← 메인으로 돌아가기</a>
    </div>
</div>

<script>
    const loginForm = document.getElementById('loginForm');
    const resultDiv = document.getElementById('result');
    const loginBtn = document.getElementById('loginBtn');

    // 이미 로그인된 경우 메인으로 리다이렉트
    if (localStorage.getItem('accessToken')) {
        window.location.href = '/';
    }

    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const usernameOrEmail = document.getElementById('usernameOrEmail').value;
        const password = document.getElementById('password').value;

        // 버튼 비활성화 및 로딩 표시
        loginBtn.disabled = true;
        loginBtn.textContent = '로그인 중...';
        resultDiv.innerHTML = '<div class="loading">로그인을 처리하고 있습니다...</div>';

        try {
            const response = await fetch('/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    usernameOrEmail: usernameOrEmail,
                    password: password
                })
            });

            if (!response.ok) {
                throw new Error(`로그인 실패 (${response.status})`);
            }

            const data = await response.json();

            // 토큰 저장
            localStorage.setItem('accessToken', data.accessToken);
            localStorage.setItem('userType', data.userType);

            resultDiv.innerHTML = `
                    <div class="success">
                        <strong>로그인 성공!</strong><br>
                        사용자 유형: ${data.userType}<br>
                        메인 페이지로 이동합니다...
                    </div>
                `;

            // 2초 후 메인 페이지로 리다이렉트
            setTimeout(() => {
                window.location.href = '/';
            }, 2000);

        } catch (error) {
            resultDiv.innerHTML = `
                    <div class="error">
                        <strong>로그인 실패:</strong><br>
                        ${error.message}
                    </div>
                `;
        } finally {
            // 버튼 다시 활성화
            loginBtn.disabled = false;
            loginBtn.textContent = '로그인';
        }
    });

    // 엔터키로 로그인
    document.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            loginForm.dispatchEvent(new Event('submit'));
        }
    });
</script>
</body>
</html>